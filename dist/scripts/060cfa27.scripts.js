function createResortAjax(a){$.ajax({url:resort_index,type:"POST",dataType:"json",data:a,headers:{Authorization:"Token token="+token}}).done(function(){console.log("Created"),loadResortsAjax()}).fail(function(){console.log("error")})}function updateResortAjax(a,b){$.ajax({url:a,type:"PATCH",dataType:"json",data:b,headers:{Authorization:"Token token="+token}}).done(function(){console.log("Updated"),loadResortsAjax()}).fail(function(){console.log("error")})}function deleteResortAjax(a){$.ajax({url:a,type:"DELETE",headers:{Authorization:"Token token="+token}}).done(function(){console.log("Deleted"),loadResortsAjax()}).fail(function(){console.log("error")})}function loadResortsAjax(){sortlist=[],$("#closest_list").html(""),$.ajax({url:resort_index,type:"GET",dataType:"json"}).done(function(a){a.forEach(function(a){sortResortList(a)});var b=numSorter(sortlist);b.forEach(function(a){appendClosestList(a)})}).fail(function(){console.log("error")})}function showResortAjax(a,b){$.ajax({url:a,type:"GET",dataType:"json",headers:{Authorization:"Token token="+token}}).done(function(a){"none"===b?renderShowResort(a.resort,a.powRating,a.temp):"admin"===b?renderShowResortAdmin(a.resort,a.stats):"favorite"===b&&renderFavorite(a.resort)}).fail(function(){console.log("error")})}function loginUserAjax(a){$.ajax({url:a,contentType:"application/json",processData:!1,type:"POST",dataType:"json",data:JSON.stringify({credentials:{email:$("#usn").val(),password:$("#psw").val()}})}).done(function(a){token=a.token,isUserGod(a),isUserAdmin(a),isUser(a)}).fail(function(a){console.log(a)})}function createUserAjax(a){$.ajax({url:user_register,type:"POST",dataType:"json",data:a}).done(function(){$("#signUp").hide(),$("#loggin").show()}).fail(function(){console.log("error")})}function updateUserAjax(a,b){$.ajax({url:a,type:"PATCH",dataType:"json",data:b,headers:{Authorization:"Token token="+token}}).done(function(){console.log("Updated")}).fail(function(){console.log("error")})}function destroyUserAjax(a){$.ajax({url:a,type:"DELETE",headers:{Authorization:"Token token="+token}}).done(function(){console.log("successful delete user")}).fail(function(){console.log("error")})}function showUserAjax(a){$.ajax({url:a,type:"GET",headers:{Authorization:"Token token="+token}}).done(function(a){renderShowUserAdmin(a)}).fail(function(){console.log("error")})}function createFavoriteAjax(a){$.ajax({url:favorite_index,type:"POST",dataType:"json",data:a,headers:{Authorization:"Token token="+token}}).done(function(){console.log("Created Favorite")}).fail(function(){console.log("error")})}function showFavoriteOfUserAjax(a){$.ajax({url:a,type:"GET",dataType:"json",headers:{Authorization:"Token token="+token}}).done(function(a){a.forEach(function(a){callFavorite(a)})}).fail(function(){console.log("error")})}function destroyFavoriteAjax(a){$.ajax({url:a,type:"DELETE",headers:{Authorization:"Token token="+token}}).done(function(){console.log("successful delete")}).fail(function(){console.log("error")})}function quote(a,b){var c="Call In Sick And Grab Your Boots",d="I Doubt Your Boss Will Mind",e="It Better Be The Weekend Already",f="At Least Nobody Else Will Be There",g="If You Are Desperate But Then Again Spring Conditions",h="Let's Go Surfing Instead";return 4>b||b>10?1>=a/20?g:2>=a/20?f:3>=a/20?e:4>=a/20?d:c:h}function getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition):zeta.innerHTML="Geolocation is not supported by this browser."}function showPosition(a){lat1=a.coords.latitude,lon1=a.coords.longitude}function calcDistance(){function a(a){return a*(Math.PI/180)}var b=6371,c=a(lat1),d=a(lat2),e=a(lat2-lat1),f=a(lon2-lon1),g=Math.sin(e/2)*Math.sin(e/2)+Math.cos(c)*Math.cos(d)*Math.sin(f/2)*Math.sin(f/2),h=2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)),i=b*h,j=Math.round(.621371*i);return j}function showDistance(){var a=calcDistance();a&&(delta.innerHTML="Miles: "+a)}function ADMINPRIV(){$("#create_crud").on("click",function(){var a=getCRUDData();createResortAjax(a)}),$("#read_crud_ID").on("click",function(){var a=(getCRUDData(),resort_show+$("#ID_crud").val());showResortAjax(a,"admin")}),$("#read_crud_name").on("click",function(){var a=getCRUDData(),b=resort_name+a.resort.name(b,"admin")}),$("#update_crud").on("click",function(){var a=$("#ID_crud").val(),b=getCRUDData(),c=resort_show+a;updateResortAjax(c,b)}),$("#destroy_crud_id").on("click",function(){var a=(getCRUDData(),resort_show+$("#ID_crud").val());deleteResortAjax(a)}),$("#destroy_crud_name").on("click",function(){var a=getCRUDData(),b=resort_name+a.resort.name;deleteResortAjax(b)})}function GODPRIV(){$("#create_crud").on("click",function(){var a=getCRUDData();createResortAjax(a)}),$("#read_crud_ID").on("click",function(){var a=(getCRUDData(),resort_show+$("#ID_crud").val());showResortAjax(a,"admin")}),$("#read_crud_name").on("click",function(){var a=getCRUDData(),b=resort_name+a.resort.name;showResortAjax(b,"admin")}),$("#update_crud").on("click",function(){var a=$("#ID_crud").val(),b=getCRUDData(),c=resort_show+a;updateResortAjax(c,b)}),$("#destroy_crud_id").on("click",function(){var a=(getCRUDData(),resort_show+$("#ID_crud").val());deleteResortAjax(a)}),$("#destroy_crud_name").on("click",function(){var a=getCRUDData(),b=resort_name+a.resort.name;deleteResortAjax(b)}),$("#User_destroy_crud_id").on("click",function(){var a=$("#User_ID_crud").val(),b=user_show+a;destroyUserAjax(b)}),$("#User_update_crud").on("click",function(){var a=$("#User_ID_crud").val(),b=user_show+a,c=$("#User_priv_crud").val(),d={user:{privileges:c}};updateUserAjax(b,d)}),$("#User_read_id").on("click",function(){var a=$("#User_ID_crud").val(),b=user_show+a;showUserAjax(b)}),$("#User_read_name").on("click",function(){var a=$("#User_email_crud").val(),b=user_name+a;showUserAjax(b)})}function getCRUDData(){var a=$("#name_crud").val(),b=$("#vertical_crud").val();b=Number(b);var c=$("#acres_crud").val();c=Number(c);var d=$("#location_crud").val();d="pws:"+d;var e={resort:{name:a,vertical:b,acres:c,location:d}};return e}function renderShowResort(a,b,c){var d=new Date;$("#resort_info").html("<h2 id=favorite"+a.id+">"+a.name+"</h2><h4 id='vertical'>Vertical Feet: "+a.vertical+"</h4><h4 id='acres'>Skiable Acres: "+a.acres+"</h4>"),lat2=a.latitude,lon2=a.longitude,showDistance(),$("#rating").html("Powder Index: "+b),c&&$("#resort_info").append("<h4 id='current_temp_f'>Temp: "+c+" â„‰ </h4>"),$("#wunderground").show(),$("#quote").html(quote(b,parseInt(d.getMonth())))}function renderShowResortAdmin(a,b){$("#resorts_info_admin").html("<h3 id=admin_resort>ID: "+a.id+" Name: "+a.name+" Vertical: "+a.vertical+" Acres: "+a.acres+" Station: "+a.location+" Users: "+b+"</h3>")}function renderShowUserAdmin(a){$("#users_info_admin").html("<h3 id=admin_user>ID: "+a.id+" Name: "+a.name+" Email: "+a.email+" Privileges: "+a.privileges+"</h3>")}function sortResortList(a){var b=a.name.replace(/ /g,"%20"),c="closest"+b;lat2=a.latitude,lon2=a.longitude;var d=calcDistance();sortlist.push({id:c,distance:d,name:a.name})}function appendClosestList(a){5265!==a.distance&&a.distance?$("#closest_list").append("<li class='resort' id="+a.id+">"+a.name+" "+a.distance+" mi. </li>"):$("#closest_list").append("<h3 class='resort' id="+a.id+">"+a.name+"</h3>")}function numSorter(a){return a.sort(function(a,b){return a.distance>b.distance?1:a.distance<b.distance?-1:0}),a}function createUser(){var a=getUserInfo();""===a.user.name||""===a.user.username||""===a.user.password?alert("Must enter a Name, Username and Password"):createUserAjax(a)}function getUserInfo(){var a=$("#new_fname").val(),b=$("#new_username").val(),c=$("#new_password").val(),d={user:{name:a,email:b,password:c,privileges:"none"}};return d}function isUserGod(a){"god"===a.privileges&&($("#loggin").hide(),$("#logged_in").show(),$("#logged_in_name").html("Welcome "+a.name),console.log("logged in as God"),$("#toggle_privileges_button").show(),$("#resort_column").hide(),$("#pow_factor").hide(),$("#about_page").hide(),document.getElementById("video_1").pause(),$("#super_div").show(),$("#favorite_list_button").show(),$("#favorite_button_div").show(),userUID=a.id,GODPRIV())}function isUserAdmin(a){"admin"===a.privileges&&($("#loggin").hide(),$("#logged_in").show(),$("#logged_in_name").html("Welcome "+a.name),console.log("logged in as Admin"),$("#resort_column").hide(),$("#pow_factor").hide(),$("#about_page").hide(),document.getElementById("video_1").pause(),$("#user_crud").hide(),$("#super_div").show(),$("#toggle_privileges_button").show(),$("#favorite_list_button").show(),$("#favorite_button_div").show(),userUID=a.id,ADMINPRIV())}function isUser(a){"none"===a.privileges&&($("#loggin").hide(),$("#logged_in").show(),$("#logged_in_name").html("Welcome "+a.name),$("#favorite_list_button").show(),$("#favorite_button_div").show(),userUID=a.id)}function createFavorite(a,b){var c={favorite:{user:b,resort:a}};createFavoriteAjax(c),$("#favorite_list").html(""),showFavoriteOfUser(b)}function destroyFavorite(a,b){var c=favorite_show+b+"/"+a;destroyFavoriteAjax(c),$("#favorite_list").html(""),showFavoriteOfUser(b)}function showFavoriteOfUser(a){var b=favorite_show+a;$("#favorite_list").html(""),showFavoriteOfUserAjax(b)}function callFavorite(a){var b=resort_show+a.resort;showResortAjax(b,"favorite")}function renderFavorite(a){var b=a.name.replace(/ /g,"%20");$("#favorite_list").append("<h3 class='resort' id=favorite"+b+">"+a.name+"</h3>")}var localAPI="http://localhost:5000",herokuAPI="https://weinberg-powder.herokuapp.com",currentAPI;currentAPI=localAPI;var resort_index=currentAPI+"/resorts",resort_show=currentAPI+"/resorts/",resort_name=currentAPI+"/resortsname?name=",user_index=currentAPI+"/users",user_show=currentAPI+"/users/",user_name=currentAPI+"/useremail?email=",user_register=currentAPI+"/register",favorite_index=currentAPI+"/favorites",favorite_show=currentAPI+"/favorites/",sortlist,userUID,token,lat1,lon1,lat2,lon2,zeta=document.getElementById("Ulocation"),delta=document.getElementById("URdistance");getLocation(),$(document).ready(function(){setTimeout(function(){getLocation()},250),$("#favorite_list").on("click",".resort",function(a){var b=resort_name+a.target.id.substring(8);$("#about_page").hide(),document.getElementById("video_1").pause(),$("#super_div").hide(),$("#favorite_button").hide(),showResortAjax(b,"none"),$("#resort_column").show(300),$("#pow_factor").show(300),$("#pow_factor_info").show(),$("#un_favorite_button").show()}),$("#closest_list").on("click",".resort",function(a){var b=resort_name+a.target.id.substring(7);$("#about_page").hide(),document.getElementById("video_1").pause(),$("#super_div").hide(),$("#un_favorite_button").hide(),showResortAjax(b,"none"),$("#resort_column").show(300),$("#pow_factor").show(300),$("#pow_factor_info").show(),$("#favorite_button").show()}),$("#search_button").on("click",function(){var a=resort_name+$("#search_box").val();return $("#about_page").hide(),document.getElementById("video_1").pause(),$("#super_div").hide(),showResortAjax(a,"none"),void 0!==userUID&&$("#favorite_button").show(),$("#resort_column").show(300),$("#pow_factor").show(300),$("#pow_factor_info").show(),$("#search_box").val(""),!1}),$("#search_box").keyup(function(a){if(13===a.keyCode){var b=resort_name+$("#search_box").val();return $("#about_page").hide(),document.getElementById("video_1").pause(),$("#super_div").hide(),showResortAjax(b,"none"),void 0!==userUID&&$("#favorite_button").show(),$("#resort_column").show(300),$("#pow_factor").show(300),$("#pow_factor_info").show(),$("#search_box").val(""),!1}}),$("#wunderground").on("click",function(){window.open("http://www.wunderground.com/?apiref=390cac5ce90ab221")}),$("#header").on("click",function(){location.reload()}),$("#favorite_button").on("click",function(){var a=$("#resort_info h2").attr("id");a=a.substring(8);var b=userUID;createFavorite(a,b)}),$("#un_favorite_button").on("click",function(){var a=$("#resort_info h2").attr("id");a=a.substring(8);var b=userUID;destroyFavorite(a,b)}),$("#closest_list_button").on("click",function(){$("#favorite_list").hide(),$("#closest_list").show(),loadResortsAjax()}),$("#favorite_list_button").on("click",function(){$("#closest_list").hide(),$("#favorite_list").show(),$("#favorite_list").html(""),showFavoriteOfUser(userUID)}),$("#signUp_page").on("click",function(){$("#loggin").hide(300),$("#login_page").hide(300),$("#signUp_page").hide(300),$("#signUp").show(300)}),$("#login_page").on("click",function(){$("#signUp").hide(300),$("#login_page").hide(300),$("#signUp_page").hide(300),$("#loggin").show(300)}),$(".logs_return").on("click",function(){$("#signUp").hide(300),$("#loggin").hide(300),$("#signUp_page").show(300),$("#login_page").show(300)}),$("#psw").keyup(function(a){if(13===a.keyCode){var b=($("#usn").val(),$("#psw").val(),currentAPI+"/login");return loginUserAjax(b),console.log("logging in"),!1}}),$("#login_button").on("click",function(){var a=($("#usn").val(),$("#psw").val(),currentAPI+"/login");return loginUserAjax(a),console.log("logging in"),!1}),$("#signup_button").on("click",function(){createUser()}),$("#toggle_privileges_button").on("click",function(){$("#super_div").toggle(),$("#resort_column").toggle(),$("#pow_factor").toggle()}),$("#logout_button").on("click",function(){console.log("logging out"),location.reload()}),setTimeout(function(){$("#main_content").show(1e3)},1e3),setTimeout(function(){loadResortsAjax()},500)});