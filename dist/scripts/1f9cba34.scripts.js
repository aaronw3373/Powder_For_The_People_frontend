var powder_iife=function(){function a(){return!0}function b(a,b){var c="Call In Sick And Grab Your Boots",d="I Doubt Your Boss Will Mind",e="It Better Be The Weekend Already",f="At Least Nobody Else Will Be There",g="If You Are Desperate But Then Again Spring Conditions",h="Let's Go Surfing Instead";return 4>b||b>10?1>=a/20?g:2>=a/20?f:3>=a/20?e:4>=a/20?d:c:h}function c(){navigator.geolocation?navigator.geolocation.getCurrentPosition(d):aa.innerHTML="Geolocation is not supported by this browser."}function d(a){L=a.coords.latitude,M=a.coords.longitude}function e(){function a(a){return a*(Math.PI/180)}var b=6371,c=a(L),d=a(N),e=a(N-L),f=a(O-M),g=Math.sin(e/2)*Math.sin(e/2)+Math.cos(c)*Math.cos(d)*Math.sin(f/2)*Math.sin(f/2),h=2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)),i=b*h,j=Math.round(.621371*i);return j}function f(){var a=e();a&&(ba.innerHTML="Miles: "+a)}function g(){$("#create_crud").on("click",function(){var a=i();y(a)}),$("#read_crud_ID").on("click",function(){var a=(i(),U+$("#ID_crud").val());C(a,"admin")}),$("#read_crud_name").on("click",function(){var a=i(),b=V+a.resort.name;C(b,"admin")}),$("#update_crud").on("click",function(){var a=$("#ID_crud").val(),b=i(),c=U+a;z(c,b)}),$("#destroy_crud_id").on("click",function(){var a=(i(),U+$("#ID_crud").val());A(a)}),$("#destroy_crud_name").on("click",function(){var a=i(),b=V+a.resort.name;A(b)}),$("#User_destroy_crud_id").on("click",function(){var a=$("#User_ID_crud").val(),b=W+a;G(b)}),$("#User_update_crud").on("click",function(){var a=$("#User_ID_crud").val(),b=W+a,c=$("#User_priv_crud").val(),d={user:{privileges:c}};F(b,d)}),$("#User_read_id").on("click",function(){var a=$("#User_ID_crud").val(),b=W+a;H(b)}),$("#User_read_name").on("click",function(){var a=$("#User_email_crud").val(),b=X+a;H(b)})}function h(){$("#create_crud").on("click",function(){var a=i();y(a)}),$("#read_crud_ID").on("click",function(){var a=(i(),U+$("#ID_crud").val());C(a,"admin")}),$("#read_crud_name").on("click",function(){var a=i(),b=V+a.resort.name(b,"admin")}),$("#update_crud").on("click",function(){var a=$("#ID_crud").val(),b=i(),c=U+a;z(c,b)}),$("#destroy_crud_id").on("click",function(){var a=(i(),U+$("#ID_crud").val());A(a)}),$("#destroy_crud_name").on("click",function(){var a=i(),b=V+a.resort.name;A(b)})}function i(){var a=$("#name_crud").val(),b=$("#vertical_crud").val();b=Number(b);var c=$("#acres_crud").val();c=Number(c);var d=$("#location_crud").val();d="pws:"+d;var e={resort:{name:a,vertical:b,acres:c,location:d}};return e}function j(a,c,d){var e=new Date;$("#resort_info").html("<h2 id=favorite"+a.id+">"+a.name+"</h2><h4 id='vertical'>Vertical Feet: "+a.vertical+"</h4><h4 id='acres'>Skiable Acres: "+a.acres+"</h4>"),N=a.latitude,O=a.longitude,f(),$("#rating").html("Powder Index: "+c),d&&$("#resort_info").append("<h4 id='current_temp_f'>Temp: "+d+" â„‰ </h4>"),$("#wunderground").show(),$("#quote").html(b(c,parseInt(e.getMonth())))}function k(a,b){$("#resorts_info_admin").html("<h3 id=admin_resort>ID: "+a.id+" Name: "+a.name+" Vertical: "+a.vertical+" Acres: "+a.acres+" Station: "+a.location+" Users: "+b+"</h3>")}function l(a){$("#users_info_admin").html("<h3 id=admin_user>ID: "+a.id+" Name: "+a.name+" Email: "+a.email+" Privileges: "+a.privileges+"</h3>")}function m(a){var b=a.name.replace(/ /g,"%20"),c="closest"+b;N=a.latitude,O=a.longitude;var d=e();Q.push({id:c,distance:d,name:a.name})}function n(a){5265!==a.distance&&a.distance?$("#closest_list").append("<li class='resort' id="+a.id+">"+a.name+" "+a.distance+" mi. </li>"):$("#closest_list").append("<li class='resort' id="+a.id+">"+a.name+"</li>")}function o(a){return a.sort(function(a,b){return a.distance>b.distance?1:a.distance<b.distance?-1:0}),a}function p(){var a=q();""===a.user.name||""===a.user.username||""===a.user.password?alert("Must enter a Name, Username and Password"):E(a)}function q(){var a=$("#new_fname").val(),b=$("#new_username").val(),c=$("#new_password").val(),d={user:{name:a,email:b,password:c,privileges:"none"}};return d}function r(a){"god"===a.privileges&&($("#loggin").hide(),$("#logged_in_name").html("Welcome "+a.name),$("#logged_in").show(300),console.log("logged in as God"),$("#toggle_privileges_button").show(),$("#resort_column").hide(),$("#pow_factor").hide(),$("#about_page").hide(),$("#un_favorite_button").hide(),$("#search_container").show(300),$("#super_div").show(300),$("#favorite_list_button").show(300),$("#favorite_button_div").show(300),sessionStorage.setItem("userUID",a.id),g())}function s(a){"admin"===a.privileges&&($("#loggin").hide(),$("#logged_in_name").html("Welcome "+a.name),$("#logged_in").show(300),console.log("logged in as Admin"),$("#resort_column").hide(),$("#pow_factor").hide(),$("#about_page").hide(),$("#user_crud").hide(),$("#un_favorite_button").hide(),$("#search_container").show(300),$("#super_div").show(300),$("#resort_crud").show(300),$("#toggle_privileges_button").show(300),$("#favorite_list_button").show(300),$("#favorite_button_div").show(300),sessionStorage.setItem("userUID",a.id),h())}function t(a){"none"===a.privileges&&($("#loggin").hide(),$("#un_favorite_button").hide(),$("#search_container").show(300),$("#logged_in_name").html("Welcome "+a.name),$("#logged_in").show(300),$("#favorite_list_button").show(300),$("#favorite_button_div").show(300),sessionStorage.setItem("userUID",a.id))}function u(a,b,c){var d={favorite:{user:b,resort:a,name:c}};I(d),$("#favorite_list").html(""),setTimeout(function(){w(b)},200)}function v(a,b){var c=_+b+"/"+a;K(c),$("#favorite_list").html(""),setTimeout(function(){w(b)},200)}function w(a){var b=_+a;$("#favorite_list").html(""),J(b)}function x(a){var b=a.name.replace(/ /g,"%20");$("#favorite_list").append("<li class='resort' id=favorite"+b+">"+a.name+"</li>")}function y(a){$.ajax({url:T,type:"POST",dataType:"json",data:a,headers:{Authorization:"Token token="+sessionStorage.getItem("powder-token")}}).done(function(){console.log("Created"),B()}).fail(function(){console.log("error")})}function z(a,b){$.ajax({url:a,type:"PATCH",dataType:"json",data:b,headers:{Authorization:"Token token="+sessionStorage.getItem("powder-token")}}).done(function(){console.log("Updated"),B()}).fail(function(){console.log("error")})}function A(a){$.ajax({url:a,type:"DELETE",headers:{Authorization:"Token token="+sessionStorage.getItem("powder-token")}}).done(function(){console.log("Deleted"),B()}).fail(function(){console.log("error")})}function B(){Q=[],$("#closest_list").html(""),$.ajax({url:T,type:"GET",dataType:"json"}).done(function(a){a.forEach(function(a){m(a)});var b=o(Q);b.forEach(function(a){n(a)})}).fail(function(){setTimeout(function(){B()},3e3),console.log("error")})}function C(a,b){$.ajax({url:a,type:"GET",dataType:"json",headers:{Authorization:"Token token="+sessionStorage.getItem("powder-token")}}).done(function(a){"none"===b?j(a.resort,a.powRating,a.temp):"admin"===b&&k(a.resort,a.stats)}).fail(function(){console.log("error")})}function D(a){$.ajax({url:a,contentType:"application/json",processData:!1,type:"POST",dataType:"json",data:JSON.stringify({credentials:{email:$("#usn").val(),password:$("#psw").val()}})}).done(function(a){sessionStorage.setItem("powder-token",a.token),r(a),s(a),t(a)}).fail(function(){alert("username or password incorrect")})}function E(a){$.ajax({url:Y,type:"POST",dataType:"json",data:a}).done(function(){$("#signUp").hide(),$("#loggin").show()}).fail(function(){console.log("error")})}function F(a,b){$.ajax({url:a,type:"PATCH",dataType:"json",data:b,headers:{Authorization:"Token token="+sessionStorage.getItem("powder-token")}}).done(function(){console.log("Updated")}).fail(function(){console.log("error")})}function G(a){$.ajax({url:a,type:"DELETE",headers:{Authorization:"Token token="+sessionStorage.getItem("powder-token")}}).done(function(){console.log("successful delete user")}).fail(function(){console.log("error")})}function H(a){$.ajax({url:a,type:"GET",headers:{Authorization:"Token token="+sessionStorage.getItem("powder-token")}}).done(function(a){l(a)}).fail(function(){console.log("error")})}function I(a){$.ajax({url:Z,type:"POST",dataType:"json",data:a,headers:{Authorization:"Token token="+sessionStorage.getItem("powder-token")}}).done(function(){console.log("Created Favorite")}).fail(function(){console.log("error")})}function J(a){$.ajax({url:a,type:"GET",dataType:"json",headers:{Authorization:"Token token="+sessionStorage.getItem("powder-token")}}).done(function(a){a.forEach(function(a){x(a)})}).fail(function(){console.log("error")})}function K(a){$.ajax({url:a,type:"DELETE",headers:{Authorization:"Token token="+sessionStorage.getItem("powder-token")}}).done(function(){console.log("successful delete")}).fail(function(){console.log("error")})}var L,M,N,O,P,Q=[],R="http://localhost:5000",S="https://weinberg-powder.herokuapp.com";P=a()?S:R;var T=P+"/resorts",U=P+"/resorts/",V=P+"/resortsname?name=",W=P+"/users/",X=P+"/useremail?email=",Y=P+"/register",Z=P+"/favorites",_=P+"/favorites/",aa=document.getElementById("Ulocation"),ba=document.getElementById("URdistance");return{getLocation:c,createFavorite:u,destroyFavorite:v,showFavoriteOfUser:w,createUser:p,showResortAjax:C,loadResortsAjax:B,loginUserAjax:D,resort_name:V,currentAPI:P}}();$(document).ready(function(){setTimeout(function(){powder_iife.getLocation()},400),$("#favorite_list").on("click",".resort",function(a){var b=powder_iife.resort_name+a.target.id.substring(8);$("#search_container").show(300),$("#about_page").hide(),$("#super_div").hide(),$("#favorite_button").hide(),powder_iife.showResortAjax(b,"none"),$("#resort_column").show(300),$("#pow_factor").show(300),$("#pow_factor_info").show(),$("#un_favorite_button").show()}),$("#closest_list").on("click",".resort",function(a){var b=powder_iife.resort_name+a.target.id.substring(7);$("#search_container").show(300),$("#about_page").hide(),$("#super_div").hide(),$("#un_favorite_button").hide(),powder_iife.showResortAjax(b,"none"),$("#resort_column").show(300),$("#pow_factor").show(300),$("#pow_factor_info").show(),$("#favorite_button").show()}),$("#search_button").on("click",function(){var a=powder_iife.resort_name+$("#search_box").val();return $("#about_page").hide(),$("#super_div").hide(),powder_iife.showResortAjax(a,"none"),void 0!==sessionStorage.getItem("userUID")&&($("#un_favorite_button").hide(),$("#favorite_button").show()),$("#resort_column").show(300),$("#pow_factor").show(300),$("#pow_factor_info").show(),$("#search_box").val(""),!1}),$("#search_box").keyup(function(a){if(13===a.keyCode){var b=powder_iife.resort_name+$("#search_box").val();return $("#about_page").hide(),$("#super_div").hide(300),powder_iife.showResortAjax(b,"none"),void 0!==sessionStorage.getItem("userUID")&&($("#un_favorite_button").hide(),$("#favorite_button").show()),$("#resort_column").show(300),$("#pow_factor").show(300),$("#pow_factor_info").show(),$("#search_box").val(""),!1}}),$("#search_button2").on("click",function(){var a=powder_iife.resort_name+$("#search_box2").val();return $("3search_container_2").hide(300),$("#about_page").hide(),$("#super_div").hide(),powder_iife.showResortAjax(a,"none"),void 0!==sessionStorage.getItem("userUID")&&($("#un_favorite_button").hide(),$("#favorite_button").show()),$("#search_container").show(300),$("#resort_column").show(300),$("#pow_factor").show(300),$("#pow_factor_info").show(),$("#search_box").val(""),!1}),$("#search_box2").keyup(function(a){if(13===a.keyCode){var b=powder_iife.resort_name+$("#search_box2").val();return $("#search_container_2").hide(300),$("#about_page").hide(),$("#super_div").hide(300),powder_iife.showResortAjax(b,"none"),void 0!==sessionStorage.getItem("userUID")&&($("#un_favorite_button").hide(),$("#favorite_button").show()),$("#search_container").show(300),$("#resort_column").show(300),$("#pow_factor").show(300),$("#pow_factor_info").show(),$("#search_box").val(""),!1}}),$("#wunderground").on("click",function(){window.open("http://www.wunderground.com/?apiref=390cac5ce90ab221")}),$("#pp").on("click",function(){location.reload()}),$("#play_pause").on("click",function(){var a=document.getElementById("video_1");0==a.paused?(a.pause(),$("#play_pause").val("Play")):(a.play(),$("#play_pause").val("Pause"))}),$("#mute_button").on("click",function(){var a=document.getElementById("video_1");a.muted?(a.muted=!1,$("#mute_button").val("Mute")):(a.muted=!0,$("#mute_button").val("Mute"))}),$("#favorite_button").on("click",function(){var a=$("#resort_info h2").attr("id");a=a.substring(8);var b=sessionStorage.getItem("userUID"),c=$("#resort_info h2").html();powder_iife.createFavorite(a,b,c)}),$("#un_favorite_button").on("click",function(){var a=$("#resort_info h2").attr("id");a=a.substring(8);var b=sessionStorage.getItem("userUID");powder_iife.destroyFavorite(a,b)}),$("#closest_list_button").on("click",function(){$("#favorite_list").hide(300),$("#closest_list").show(300),powder_iife.loadResortsAjax()}),$("#favorite_list_button").on("click",function(){$("#closest_list").hide(300),$("#favorite_list").show(300),$("#favorite_list").html(""),powder_iife.showFavoriteOfUser(sessionStorage.getItem("userUID"))}),$("#signUp_page").on("click",function(){$("#loggin").hide(300),$("#login_page").hide(300),$("#signUp_page").hide(300),$("#signUp").show(300)}),$("#login_page").on("click",function(){$("#signUp").hide(300),$("#login_page").hide(300),$("#signUp_page").hide(300),$("#loggin").show(300)}),$(".logs_return").on("click",function(){$("#signUp").hide(300),$("#loggin").hide(300),$("#signUp_page").show(300),$("#login_page").show(300)}),$("#psw").keyup(function(a){if(13===a.keyCode){var b=($("#usn").val(),$("#psw").val(),powder_iife.currentAPI+"/login");return powder_iife.loginUserAjax(b),console.log("logging in"),!1}}),$("#signin_button").on("click",function(){var a=($("#usn").val(),$("#psw").val(),powder_iife.currentAPI+"/login");powder_iife.loginUserAjax(a),console.log("logging in")}),$("#signup_button").on("click",function(){powder_iife.createUser()}),$("#toggle_privileges_button").on("click",function(){$("#super_div").toggle(300),$("#resort_column").toggle(300),$("#pow_factor").toggle(300)}),$("#logout_button").on("click",function(){console.log("logging out"),location.reload(),sessionStorage.setItem("powder-token",null),sessionStorage.setItem("userUID",null)}),setTimeout(function(){powder_iife.loadResortsAjax()},500),setTimeout(function(){$("#main_content").show(1e3)},500),setTimeout(function(){$("#header").show(1e3)},1500)});